{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "Rebuild a full ERP-style billing module (estimates/invoices saved, listed, editable) integrated with contacts (Bill To), inventory stock, and purchase-module pricing, including pending-amount tracking and payment-aware balance calculations.",
  "architectural_notes": [
    "Billing module is ERP-style: persist and relate estimates/invoices, products, contacts, inventory, purchases, and payments.",
    "Billing calculations must derive outstanding/pending balance from historical estimates/invoices minus recorded payments."
  ],
  "known_issues": [
    "Automated build attempt for the billing module failed previously with 'AI was unable to implement your request'; may require breaking work into smaller steps."
  ],
  "isFixRequest": false,
  "existing_features": [
    {
      "id": "feature-fix-the-estimate-product-selection-add-flow-so-selecting-a-product-reliably-populates-the-draft-line-item-fields-productid-description-and-rate-and-the-user-can-add-the-line-item-without-manual-re-entry-or-losing-the-selected-product",
      "title": "Fix the estimate product selection/add flow so selecting a product reliably populates the draft line item fields (productId, description, and rate) and the user can add the line item without manual re-entry or losing the selected product.",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-billing-estimate-editor-supports-full-erp-saving-create-and-edit-estimates-that-persist-to-the-backend-and-appear-in-the-billing-list-with-correct-totals-and-status",
      "title": "Ensure the billing estimate editor supports full ERP saving: create and edit estimates that persist to the backend and appear in the Billing list with correct totals and status.",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-add-ensure-bill-to-customer-selection-in-the-estimate-editor-using-the-existing-bill-to-contacts-list-and-display-the-customer-s-previous-outstanding-pending-amount-with-a-clear-red-flag-visual-when-pending-0",
      "title": "Add/ensure Bill To customer selection in the estimate editor using the existing Bill To contacts list, and display the customer’s previous outstanding/pending amount with a clear red-flag visual when pending > 0.",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-inventory-stock-is-enforced-and-updated-based-on-product-linked-line-items-validate-available-stock-when-adding-saving-line-items-decrement-stock-on-estimate-creation-and-adjust-stock-correctly-when-editing-an-estimate-restore-original-quantities-then-apply-updated-quantities",
      "title": "Ensure inventory stock is enforced and updated based on product-linked line items: validate available stock when adding/saving line items, decrement stock on estimate creation, and adjust stock correctly when editing an estimate (restore original quantities then apply updated quantities).",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-auto-fill-the-estimate-line-item-rate-price-from-the-most-recent-purchase-price-recorded-in-the-purchase-module-for-the-selected-product-if-no-purchase-history-exists-for-that-product-fall-back-to-the-product-s-default-price",
      "title": "Auto-fill the estimate line item rate/price from the most recent purchase price recorded in the Purchase module for the selected product; if no purchase history exists for that product, fall back to the product’s default price.",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    },
    {
      "id": "feature-record-payments-against-estimates-and-ensure-pending-amount-is-automatically-recalculated-and-displayed-consistently-across-the-billing-list-and-customer-pending-calculations",
      "title": "Record payments against estimates and ensure pending amount is automatically recalculated and displayed consistently across the Billing list and customer pending calculations.",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Rebuild billing module as full ERP with persistent storage: save/list/edit estimates/invoices, products, and line items",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-2",
      "summary": "Line items support qty, price, and amount calculations; no taxes",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Show previous/pending amount with red-flag indicator; auto-calculate pending from prior estimates/invoices and subtract any recorded payments",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Add Bill To contact selection/management in billing module",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-5",
      "summary": "Integrate billing qty with inventory stock levels",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "Auto-fill item price from most recent purchase price in purchase module",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-13",
      "summary": "If backend estimate/billing types/APIs need to change to fully support product-linked line items and inventory adjustments, implement the minimal backend changes and add a conditional migration in backend/migration.mo to preserve existing persisted estimates across upgrades.",
      "reqIds": [
        "REQ-7"
      ],
      "status": "pending"
    }
  ],
  "projectName": "Rebuild ERP Billing module: estimates with product-linked line items, pending balance, inventory deduction, and purchase-price autofill",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}